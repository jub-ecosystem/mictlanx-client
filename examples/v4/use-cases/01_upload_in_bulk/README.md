# USE CASE 1 - Upload multiple files to MictlanX
The task is simple we want to transfer a bunch of files to MictlanX and then consume them everywhere using the ```MictlanX - Client``` or by using the API.

In you dont have any file, dont worry you can generate using the ```nachocode/utils:file-generator``` docker image. Setting up the file generator to produce $n$ random files with a 10MB avg file size and stdev file size of 2MB. 

For the purpose of this example we perform a request to MictlanX at mean arrival rate ($\lambda$) . So we generate a exponentially distributed interarrival times with a mean of $\frac{1}{\lambda}$. The next diagram shows a conceptual representation of the whole process from producer to consumer side:  

<div align=center>
<a href="https://test.pypi.org/project/mictlanx/"><img src="./assets/example.png" alt="build - 0.0.33"></a>
</div>

## Prerequisites
You need some libraries before you continue, installig them with the following command:
```bash
pip3 install -r ./requirements.txt
```

## Getting started
To execute this example in your local machine, you need to generate the files, please use the following command: 
```sh
docker run \
        --name fg-0 \
        -e AVG_FILE_SIZE="10MB" \
        -e STD_FILE_SIZE="2MB" \
        -e N=100 \
        -e OUTPUT_FOLDER="/test/out" \
        -e FILENAME_PREFIX="" \
        -e FILENAME_SEPARATOR="" \
        -e MAX_THREADS="2" \
        -v /test/out:/test/out \
        -d nachocode/utils:file-generator
```
Please feel free to change the parameters as you like. This command generate a folder ```$OUTPUT_PATH``` that contains all the generated files. It also generate a metadata CSV that containts basic information about the generated file, so every record in the CSV file is the metadata of a file. This CSV file is located at ```$OUTPUT_PATH/trace.csv```

Now you are ready to execute the script to upload your generated files, first located the ```main.py``` and execute using ```python3```:

First you need to set a value to a ```ENV_FILE_PATH``` in order to define you own values for the environment variables, :warning this is a example in my context:
```sh
export ENV_FILE_PATH=/home/nacho/Programming/Python/mictlanx/examples/v4/use-cases/01_upload_in_bulk/.env
```

A brief description of the avialable environment variables:
```
# By default this points to the trace generated by file-generator if you decide to upload a different batch please set to blank. 

TRACE_PATH="/test/out/trace.csv"

# By default it points to the output_foler of the file-generator. Please be free to change to another batch of files and set TRACE_PATH to empty string

SOURCE_FOLDER="/test/out"

# Reach me out to get the peers information :) jesus.castillo.b@cinvestav.mx

MICTLANX_PEERS="mictlanx-peer-0:localhost:7000"

# Unique identifier of the client
MICTLANX_CLIENT_ID="client-0"

# Unique identifier of the bucket.
MICTLANX_BUCKET_ID="default"

# Number of concurrent threads that perform put and get operation asynchronously
MICTLANX_MAX_WORKERS="2"
```
Now the script read the env file and take the environmet variable defined in the .env

```sh
python3 ./examples/v4/use-cases/01_upload_in_bulk/src/main.py
```



If you run the above steps without any error. Congratz :tada: now you can obtain your files using the ```MictlanX - Client``` as follows:
```bash
python3 ./examples/v4/02_get.py <KEY> <NUM_DOWNLOADS> 
```

or instead use the API go to your favorite browser and type the following:
```
http://<PEER_IP_ADDR>:<PEER_PORT>/api/v4/<KEY>
```

if you only want the metadata type the following in the search bar of your favorite browser:
```
http://<PEER_IP_ADDR>:<PEER_PORT>/api/v4/metadata/<KEY>
```